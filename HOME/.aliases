# -*- mode: shell-script -*-
alias g='grep'
alias h='history'

alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

alias e='emacsclient --no-wait'
alias date-iso8601='date "+%Y-%m-%dT%H:%M:%S%z"'
alias less='less --LONG-PROMPT --LINE-NUMBERS'

alias rubygems='f() { open "https://rubygems.org/gems/$1" }; f'
alias npmjs='f() { open "https://www.npmjs.com/package/$1" }; f'

if type exa &>/dev/null; then
  alias ll='exa --long --all --git'
fi

if type rg &>/dev/null; then
  alias rg='rg --no-heading --hidden'
fi

if type ruby &>/dev/null; then
  # https://github.com/ruby/un
  alias http-server='ruby -run -e httpd'
fi

if type gem &>/dev/null; then
  alias gem-view='f() { gem info --remote $1 | grep --only-matching --extended-regexp --max-count=1 "https?://.+" | xargs open }; f'
fi

if type bundler &>/dev/null; then
  # https://bundler.io/blog/2019/05/14/solutions-for-cant-find-gem-bundler-with-executable-bundle.html
  alias bundler-exact-install='gem install bundler -v "$(grep -A 1 "BUNDLED WITH" Gemfile.lock | tail -n 1)"'

  if type fswatch &>/dev/null; then
    alias rspec-watch='f() { fswatch -0 -l 0.2 -r -i "_spec\.rb$" "${1:-spec/}" | xargs -0 -n 1 -I % bundle exec rspec "%" }; f'
  fi
fi

if type npm &>/dev/null; then
  alias babel='npm exec --no --package=@babel/cli -- babel'
  alias eslint='npm exec --no -- eslint'
  alias jest='npm exec --no -- jest'
  alias jest-watch='npm exec --no -- jest --watch'
  alias jest-debug='node --inspect-brk ./node_modules/.bin/jest --runInBand'
  alias postcss='npm exec --no --package=postcss-cli -- postcss'
  alias prettier='npm exec --no -- prettier --write'
  alias upgradeps='npm exec -- upgradeps'
  alias stylelint='npm exec --no -- stylelint'
  alias yarn='npm exec -- yarn'
  alias zx='npm exec -- zx'
fi

if type tree &>/dev/null; then
  alias tree='tree -aCF -I .git'
fi

if type querly &>/dev/null; then
  alias ruby-grep='querly find'
fi

if type jq &>/dev/null; then
  alias bump-npm-deps='jq --raw-output ".dependencies | keys[]" package.json | xargs -I{} npm install {}'
  alias bump-npm-deps-dev='jq --raw-output ".devDependencies | keys[]" package.json | xargs -I{} npm install {}'
fi

if type docker &>/dev/null; then
  alias dockrun='docker run --rm --interactive --tty --volume=${PWD}:/work --workdir=/work'
fi

if type rdbg &>/dev/null; then
  alias ruby-debug=rdbg
fi

# See https://github.com/sharkdp/bat#highlighting---help-messages
if type bat &>/dev/null; then
  alias help='f() { (test $# -ne 0) && ("$@" --help 2>&1 | bat --language cmd-help --style plain) }; f'
fi

if type most &>/dev/null; then
  alias man='man -P most'
fi
