#!/usr/bin/env ruby

require 'html/pipeline'

filename = ARGV[0]

unless filename
  STDERR.puts "Usage: #{$PROGRAM_NAME} FILE"
  exit 1
end

unless File.exist? filename
  STDERR.puts "No such file: #{filename}"
  exit 1
end

file_content = File.read(filename, encoding: Encoding::UTF_8)

pipeline = HTML::Pipeline.new [
  HTML::Pipeline::MarkdownFilter,
  HTML::Pipeline::TableOfContentsFilter,
  HTML::Pipeline::AutolinkFilter,
]

puts pipeline.call(file_content)[:output].to_s
